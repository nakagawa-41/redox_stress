library(here)
# Read data and metadata
dt <- read.table(here("/counts.txt"))
# Read data and metadata
dt <- read.table(here("data/counts.txt"))
View(dt)
metadata <- read.table(here("data/samples.txt"))
metadata <- read.table(here("data/samples.txt", sep = "\t"))
library(here)
# Read data and metadata
dt <- read.table(here("data/counts.txt"))
metadata <- read.table(here("data/samples.txt")
metadata <- read.table(here("data/samples.txt"))
metadata <- read.table(here("data/samples.txt"))
Error in scan(file = file, what = what, sep = sep, quote = quote, dec = dec,  :
readLines(here("data/samples.txt"))
metadata <- read.table(here("data/samples.txt"), sep = "\t")
View(metadata)
View(dt)
metadata <- read.table(here("data/samples.txt"), sep = "\t", header = TRUE)
View(metadata)
# sample名をBA_1, BA_2, cholestasis_1などに変更する　後のpheatmapの順番で変更
colnames(dt) #"H15" "H16" "H17" "H20" "H21" "H30" "H38" "H39" "H42" "H43" "H44" "H6"
View(metadata)
metadata <- read.table(here("data/samples.txt"), sep = "\t", header = TRUE)
colnames(dt)
metadata
# SRA_Label を名前変更用のルックアップテーブルにする
name_map <- setNames(metadata$Sample.name, metadata$SRA_Label)
# colnames(dt) を `name_map` に基づいて置換
colnames(dt) <- name_map[colnames(dt)]
# 変更後の確認
print(colnames(dt))
# deseqDataSetFromMatrixのdesignのためにstudyDesignを作成する
sample_name <- colnames(dt)
StudyDesign <- data.frame(
row.names = sample_name,
sample = sample_name
) %>%
mutate(condition = case_when(
str_detect(sample, pattern = "Cholestasis") ~ "Cholestasis",
TRUE ~ "BA"
)
)
library(tidyverse)
# import library
library(DESeq2)
# Plot total read counts per sample
barplot(colSums(dt1)/1e6, main="Total read counts (millions)")
# Plot total read counts per sample
barplot(colSums(dt)/1e6, main="Total read counts (millions)")
# Read data and metadata
dt <- read.table(here("data/counts.txt"), header = TRUE, row.names = 1)
View(dt)
# Function to create study design
create_study_design <- function(sample_names) {
data.frame(row.names = sample_names, sample = sample_names) %>%
mutate(condition = if_else(str_detect(sample, "Cholestasis"), "Cholestasis", "BA"))
}
# Generate study design
StudyDesign <- create_study_design(colnames(dt))
# Prefiltering: remove low expression gene < 10 lead counts in total data
dds <- dds[rowSums(counts(dds)) >= 10, ]
# create DESeqDataSetObject
dds <- DESeqDataSetFromMatrix(countData = dt, colData = StudyDesign, design = ~ condition)
# Prefiltering: remove low expression gene < 10 lead counts in total data
dds <- dds[rowSums(counts(dds)) >= 10, ]
# Generate study design
StudyDesign <- create_study_design(colnames(dt))
# create DESeqDataSetObject
dds <- DESeqDataSetFromMatrix(countData = dt, colData = StudyDesign, design = ~ condition)
# Read data and metadata
dt <- read.table(here("data/counts.txt"), header = TRUE, row.names = 1)
metadata <- read.table(here("data/samples.txt"), sep = "\t", header = TRUE)
# Rename columns using metadata mapping
name_map <- setNames(metadata$Sample.name, metadata$SRA_Label)
colnames(dt) <- name_map[colnames(dt)]
# Function to create study design
create_study_design <- function(sample_names) {
data.frame(row.names = sample_names, sample = sample_names) %>%
mutate(condition = if_else(str_detect(sample, "Cholestasis"), "Cholestasis", "BA"))
}
# Generate study design
StudyDesign <- create_study_design(colnames(dt))
# create DESeqDataSetObject
dds <- DESeqDataSetFromMatrix(countData = dt, colData = StudyDesign, design = ~ condition)
# Prefiltering: remove low expression gene < 10 lead counts in total data
dds <- dds[rowSums(counts(dds)) >= 10, ]
# ddsのreferenceを設定する
dds$condition <- relevel(dds$condition, ref = "Cholestasis")
# log2(n+1)
ntd <- normTransform(dds)
# Plot total read counts per sample
barplot(colSums(dt)/1e6, main="Total read counts (millions)")
library(ggplot2)
library(pheatmap)
library(viridis)
library(here)
source(here("scripts/DESeq2_analysis.R"))
