# import library
library(Rsubread)
library(here)
# set directory
FILE_DIR <- "/Volumes/Elements/0406_BA_TotalRNA-seq/01_RawData/05_RNAlibrary"
SAVE_DIR <- here("data")
# make directory (if not present)
if(!dir.exists(SAVE_DIR)) {
dir.create(SAVE_DIR, recursive = TRUE)
}
# get BAM file lists
fl <- list.files(FILE_DIR, pattern = "\\.bam$")
print(fl) # check data
ANNOTATION_FILE <- here("data/gencode.v46.chr_patch_hapl_scaff.annotation.gtf")
# Define splitLeft function if necessary
removeEnsemblVersion <- function(x) {
return(strsplit(x, "[.]")[[1]][[1]])
}
a1 <- c("asdfad.asdfasd", "ASDFasdf.sdf")
sapply(a1, removeEnsemblVersion)
a1 <- sapply(a1, removeEnsemblVersion)
a1
file <- "H6.sort"
# run featurecount
fc <- featureCounts(
files = paste(FILE_DIR, file, sep="/"),
isPairedEnd = T,
annot.ext=ANNOTATION_FILE,
isGTFAnnotationFile=T,
nthreads=4,
allowMultiOverlap = T
)
file <- "H6.sort.bam"
# run featurecount
fc <- featureCounts(
files = paste(FILE_DIR, file, sep="/"),
isPairedEnd = T,
annot.ext=ANNOTATION_FILE,
isGTFAnnotationFile=T,
nthreads=4,
allowMultiOverlap = T
)
ANNOTATION_FILE <- "/Volumes/Elements/0406_BA_TotalRNA-seq/03_Analysis/02_R_DEG/02_reference/gencode.v46.chr_patch_hapl_scaff.annotation.gtf"
# run featurecount
fc <- featureCounts(
files = paste(FILE_DIR, file, sep="/"),
isPairedEnd = T,
annot.ext=ANNOTATION_FILE,
isGTFAnnotationFile=T,
nthreads=4,
allowMultiOverlap = T
)
# count data
dt <- fc$counts
rownames(dt) <- sapply(rownames(dt), removeEnsemblVersion) # delete ensembl version
View(dt)
# set sample name as column
colnames(dt) <- gsub(".bam$", "", fl)
# set sample name as column
colnames(dt) <- gsub(".bam$", "", file)
View(dt)
